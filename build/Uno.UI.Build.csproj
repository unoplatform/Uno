<Project Sdk="Microsoft.NET.Sdk">

	<PropertyGroup>
		<TargetFramework>net462</TargetFramework>
		<UpdateAssemblyInfo>false</UpdateAssemblyInfo>
	</PropertyGroup>

	<ItemGroup>
		<Content Include="..\src\global.json" Link="global.json" />
	</ItemGroup>

	<PropertyGroup Condition="'$(BuildingInsideVisualStudio)'==''">
		<AppVersion>$(GITVERSION_SemVer)</AppVersion>

		<NuGetBin>.\nuget\NuGet.exe</NuGetBin>
		<OutputDir>$(BUILD_ARTIFACTSTAGINGDIRECTORY)</OutputDir>
		<Configuration>$(CombinedConfiguration.Split('|')[0])</Configuration>
		<Platform>$(CombinedConfiguration.Split('|')[1])</Platform>
		<AppEnvironment Condition="'$(CombinedConfiguration)' != '' and $(CombinedConfiguration.Split('|').Length) &gt; 2">$(CombinedConfiguration.Split('|')[2])</AppEnvironment>

		<UpdateAssemblyInfo>false</UpdateAssemblyInfo>
		<_isWindows>$([MSBuild]::IsOsPlatform(Windows))</_isWindows>

		<!-- Disable automatic documentation generation as the step is executed explicitly through GenerateDoc -->
		<BuildDocFx>false</BuildDocFx>
	</PropertyGroup>

	<ItemGroup>
		<None Include="..\src\Directory.Build.targets" Link="Directory.Build.targets" />
	</ItemGroup>

	<ItemGroup>
		<PackageReference Include="docfx.console" Version="2.59.3" GeneratePathProperty="true" />
		<PackageReference Include="MSBuildTasks">
			<Version>1.5.0.235</Version>
		</PackageReference>
		<PackageReference Include="NUnit.Runners">
			<Version>3.12.0</Version>
		</PackageReference>
	</ItemGroup>

	<Target Name="UnoVSBuild" AfterTargets="Build" Condition="'$(BuildingInsideVisualStudio)'!=''">
		<Warning Text="Building this project under Visual Studio has no effect." />
	</Target>

	<Target Name="BuildGeneric" AfterTargets="Build" Condition="'$(BuildingInsideVisualStudio)'==''">

		<Message Text="Building for $(Configuration) and $(Platform) BuildReason:$(BUILD_REASON) Version:$(GitVersion_SemVer) UNO_UWP_BUILD:$(UNO_UWP_BUILD)" />

		<CallTarget Targets="UpdateFileVersions;UpdateTasksSHA;PrepareNuGetPackage" Condition="$(_isWindows)" />

		<CallTarget Targets="RunAPISyncTool" Condition="'$(UNO_UWP_BUILD)'=='false'" />

		<CallTarget Targets="BuildCI" Condition="'$(Configuration)'=='Release' and $(_isWindows)" />

		<CallTarget Targets="PublishVSIX2019" Condition="'$(Configuration)'=='Release' and $(_isWindows)" />
	</Target>

	<Target Name="BuildNet6" AfterTargets="Build" Condition="'$(BuildingInsideVisualStudio)'==''">
		<Message Text="Building for $(Configuration) and $(Platform) BuildReason:$(BUILD_REASON) Version:$(GitVersion_SemVer) UNO_UWP_BUILD:$(UNO_UWP_BUILD)" />

		<CallTarget Targets="UpdateFileVersions;UpdateTasksSHA;PrepareNuGetPackage" Condition="$(_isWindows)" />

		<CallTarget Targets="RunAPISyncTool" Condition="'$(UNO_UWP_BUILD)'=='false'" />
	</Target>

	<Target Name="GeneratePackages" AfterTargets="Build" Condition="'$(BuildingInsideVisualStudio)'==''">

		<Message Text="Building for $(Configuration) and $(Platform) BuildReason:$(BUILD_REASON) Version:$(GitVersion_SemVer) UNO_UWP_BUILD:$(UNO_UWP_BUILD)" />

		<CallTarget Targets="UpdateFileVersions;UpdateTasksSHA;PrepareNuGetPackage" Condition="$(_isWindows)" />

		<CallTarget Targets="BuildNuGetPackage" Condition="'$(Configuration)'=='Release'" />
	</Target>
	
	<Target Name="Build2022VSIX" Condition="'$(BuildingInsideVisualStudio)'==''">
		<CallTarget Targets="UpdateFileVersions" Condition="$(_isWindows)" />
		
		<MSBuild Properties="Configuration=Release"
             Projects="..\src\SolutionTemplate\UnoSolutionTemplate.VSIX.2022\UnoSolutionTemplate.VSIX.2022.csproj"
             Targets="Restore;Build"
             RebaseOutputs="false"
             BuildInParallel="true" />

		<CallTarget Targets="PublishVSIX2022" Condition="'$(Configuration)'=='Release' and $(_isWindows)" />
	</Target>

	<Target Name="UpdateFileVersions">
		<PropertyGroup>
			<VSXNamespace>
				<Namespace Prefix="x" Uri="http://schemas.microsoft.com/developer/vsx-schema/2011"/>
			</VSXNamespace>
			<MSBuildDeveloperNamespace>
				<Namespace Prefix="x" Uri="http://schemas.microsoft.com/developer/msbuild/2003"/>
			</MSBuildDeveloperNamespace>
		</PropertyGroup>

		<ItemGroup>
			<_VSIXInput Include="..\src\SolutionTemplate\UnoSolutionTemplate.VSIX.2019\source.extension.vsixmanifest" />
			<_VSIXInput Include="..\src\SolutionTemplate\UnoSolutionTemplate.VSIX.2022\source.extension.vsixmanifest" />
		</ItemGroup>

		<XmlPoke XmlInputPath="%(_VSIXInput.Identity)"
							 Query="/x:PackageManifest/x:Metadata/x:Identity/@Version"
							 Value="$(GITVERSION_MajorMinorPatch).$(GITVERSION_CommitsSinceVersionSource)"
							 Namespaces="$(VSXNamespace)"
							 />

		<ItemGroup>
			<_PackageToUpdate Include="Uno.UI" />
			<_PackageToUpdate Include="Uno.UI.RemoteControl" />

			<_legacyProject Include="..\src\SolutionTemplate\**\*.Uwp.csproj"/>
			<_legacyProject Include="..\src\SolutionTemplate\**\*.Droid.csproj"/>
			<_legacyProject Include="..\src\SolutionTemplate\**\*.iOS.csproj"/>
			<_legacyProject Include="..\src\SolutionTemplate\**\*.macOS.csproj"/>
			<_legacyProject Include="..\src\SolutionTemplate\**\*.Wpf.Host.csproj"/>

			<_sdkProject Include="..\src\SolutionTemplate\**\*.Mobile.csproj"/>
			<_sdkProject Include="..\src\SolutionTemplate\**\*.Wasm.csproj"/>
			<_sdkProject Include="..\src\SolutionTemplate\**\*.Skia.*.csproj"/>
			<_sdkProject Include="..\src\SolutionTemplate\UnoLibraryTemplate\CrossTargetedLibrary.csproj"/>
			<_sdkProject Include="..\src\SolutionTemplate\UnoLibraryTemplate.net6\CrossTargetedLibrary.csproj"/>
			<_sdkProject Include="..\src\SolutionTemplate\UnoLibraryTemplate.net6\CrossTargetedLibrary.csproj"/>
			<_sdkProject Include="..\src\SolutionTemplate\UnoUITestTemplate\UnoUITestTemplate.csproj"/>
			<_sdkProject Include="..\src\SolutionTemplate\Uno.ProjectTemplates.Dotnet\content\unolib-crossruntime\UnoCrossRuntimeLib\*.csproj"/>
		</ItemGroup>

		<XmlPoke XmlInputPath="%(_legacyProject.Identity)"
							 Query="//x:PackageReference[@Include='Uno.UI.RemoteControl']/@Version"
							 Value="$(GitVersion_SemVer)"
							 Namespaces="$(MSBuildDeveloperNamespace)"
							 />
		
		<XmlPoke XmlInputPath="%(_legacyProject.Identity)"
							 Query="//x:PackageReference[@Include='Uno.UI']/@Version"
							 Value="$(GitVersion_SemVer)"
							 Namespaces="$(MSBuildDeveloperNamespace)"
							 />

		<XmlPoke XmlInputPath="%(_legacyProject.Identity)"
							 Query="//x:PackageReference[@Include='Uno.UI.Adapter.Microsoft.Extensions.Logging']/@Version"
							 Value="$(GitVersion_SemVer)"
							 Namespaces="$(MSBuildDeveloperNamespace)"
							 />

		<!-- Update templates for Uno.UI -->
		<XmlPoke XmlInputPath="%(_sdkProject.Identity)"
							 Query="//PackageReference[@Include='Uno.UI']/@Version"
							 Value="$(GitVersion_SemVer)" />
		<XmlPoke XmlInputPath="%(_sdkProject.Identity)"
							 Query="//PackageReference[@Include='Uno.UI.RemoteControl']/@Version"
							 Value="$(GitVersion_SemVer)" />
		<XmlPoke XmlInputPath="%(_sdkProject.Identity)"
							 Query="//PackageReference[@Include='Uno.UI.WebAssembly']/@Version"
							 Value="$(GitVersion_SemVer)" />
		<XmlPoke XmlInputPath="%(_sdkProject.Identity)"
							 Query="//PackageReference[@Include='Uno.UI.Skia.Gtk']/@Version"
							 Value="$(GitVersion_SemVer)" />
		<XmlPoke XmlInputPath="%(_sdkProject.Identity)"
							 Query="//PackageReference[@Include='Uno.UI.Skia.Linux.FrameBuffer']/@Version"
							 Value="$(GitVersion_SemVer)" />
		<XmlPoke XmlInputPath="%(_sdkProject.Identity)"
							 Query="//PackageReference[@Include='Uno.UI.Skia.Wpf']/@Version"
							 Value="$(GitVersion_SemVer)" />
		<XmlPoke XmlInputPath="%(_sdkProject.Identity)"
							 Query="//PackageReference[@Include='Uno.UI.Skia.Tizen']/@Version"
							 Value="$(GitVersion_SemVer)" />
		<XmlPoke XmlInputPath="%(_sdkProject.Identity)"
							 Query="//PackageReference[@Include='Uno.UI.Runtime.WebAssembly']/@Version"
							 Value="$(GitVersion_SemVer)" />
		<XmlPoke XmlInputPath="%(_sdkProject.Identity)"
							 Query="//PackageReference[@Include='Uno.UI.Lottie']/@Version"
							 Value="$(GitVersion_SemVer)" />

		<!-- Update templates for Uno.WinUI -->
		<XmlPoke XmlInputPath="%(_sdkProject.Identity)"
							 Query="//PackageReference[@Include='Uno.WinUI']/@Version"
							 Value="$(GitVersion_SemVer)" />
		<XmlPoke XmlInputPath="%(_sdkProject.Identity)"
							 Query="//PackageReference[@Include='Uno.WinUI.RemoteControl']/@Version"
							 Value="$(GitVersion_SemVer)" />
		<XmlPoke XmlInputPath="%(_sdkProject.Identity)"
							 Query="//PackageReference[@Include='Uno.WinUI.WebAssembly']/@Version"
							 Value="$(GitVersion_SemVer)" />
		<XmlPoke XmlInputPath="%(_sdkProject.Identity)"
							 Query="//PackageReference[@Include='Uno.WinUI.Skia.Gtk']/@Version"
							 Value="$(GitVersion_SemVer)" />
		<XmlPoke XmlInputPath="%(_sdkProject.Identity)"
							 Query="//PackageReference[@Include='Uno.WinUI.Skia.Linux.FrameBuffer']/@Version"
							 Value="$(GitVersion_SemVer)" />
		<XmlPoke XmlInputPath="%(_sdkProject.Identity)"
							 Query="//PackageReference[@Include='Uno.WinUI.Skia.Wpf']/@Version"
							 Value="$(GitVersion_SemVer)" />
		<XmlPoke XmlInputPath="%(_sdkProject.Identity)"
							 Query="//PackageReference[@Include='Uno.WinUI.Skia.Tizen']/@Version"
							 Value="$(GitVersion_SemVer)" />
		<XmlPoke XmlInputPath="%(_sdkProject.Identity)"
							 Query="//PackageReference[@Include='Uno.WinUI.Runtime.WebAssembly']/@Version"
							 Value="$(GitVersion_SemVer)" />
		<XmlPoke XmlInputPath="%(_sdkProject.Identity)"
							 Query="//PackageReference[@Include='Uno.WinUI.Lottie']/@Version"
							 Value="$(GitVersion_SemVer)" />


		<!-- Update templates for generic packages -->
		<XmlPoke XmlInputPath="%(_sdkProject.Identity)"
							 Query="//PackageReference[@Include='Uno.UI.Adapter.Microsoft.Extensions.Logging']/@Version"
							 Value="$(GitVersion_SemVer)" />	</Target>

	<Target Name="UpdateTasksSHA">

		<ItemGroup>
			<_Sha1Replace Include="..\src\SourceGenerators\Uno.UI.Tasks\**\*.cs" />
			<_Sha1Replace Include="..\src\SourceGenerators\Uno.UI.Tasks\Uno.UI.Tasks.csproj" />
			<_Sha1Replace Include="..\src\SourceGenerators\Uno.UI.Tasks\Content\Uno.UI.Tasks.targets" />
		</ItemGroup>

    <WriteLinesToFile
        File="%(_Sha1Replace.Identity)"
        Lines="$([System.IO.File]::ReadAllText(%(_Sha1Replace.Identity)).Replace('v0','v$(GITVERSION_VersionSourceSha)'))"
        Overwrite="true" />

	</Target>

	<Target Name="BuildCI">
		<MSBuild Properties="Configuration=Release_NoSamples;InformationalVersion=$(GITVERSION_InformationalVersion);CI_Build=true;_IsCIBuild=true;PackageOutputPath=$(BUILD_ARTIFACTSTAGINGDIRECTORY)\vslatest-generic;PackageVersion=$(GITVERSION_SemVer)"
             Projects="..\src\Uno.UI-packages-no-net6.slnf"
             Targets="Restore;Build"
             RebaseOutputs="false"
             BuildInParallel="true" />

	</Target>

	<Target Name="BuildCINet6">

		<MSBuild Properties="Configuration=Release;InformationalVersion=$(GITVERSION_InformationalVersion);CI_Build=true;IS_NET6_BUILD=true;_IsCIBuild=true;PackageOutputPath=$(BUILD_ARTIFACTSTAGINGDIRECTORY)\vslatest-net6;PackageVersion=$(GITVERSION_SemVer)"
             Projects="..\src\Uno.UI-net6-only.slnf"
             Targets="Restore;Build"
             RebaseOutputs="false"
             BuildInParallel="true" />

	</Target>

	<Target Name="BuildSyncGenerator">
		<!-- Restore the nuget packages for the whole solution -->
		<MSBuild Properties="Configuration=Release;InformationalVersion=$(GITVERSION_InformationalVersion);CI_Build=true;_IsCIBuild=true" Projects="..\src\Uno.UI-packages-no-net6.slnf" Targets="Restore" RebaseOutputs="false" BuildInParallel="true" />
		<MSBuild Properties="Configuration=Release" Projects="..\src\Uno.UWPSyncGenerator\Uno.UWPSyncGenerator.csproj" Targets="Restore;Build" />

		<ItemGroup>
			<MixinTargetFrameworks Include="xamarinios10" />
			<MixinTargetFrameworks Include="MonoAndroid12.0" />
			<MixinTargetFrameworks Include="xamarinmac20" />
			<MixinTargetFrameworks Include="net461" />
			<MixinTargetFrameworks Include="netstandard2.0" />
		</ItemGroup>
		
		<MSBuild Properties="Configuration=Release;InformationalVersion=$(GITVERSION_InformationalVersion);CI_Build=true;_IsCIBuild=true"
						 Projects="..\src\T4Generator\T4Generator.csproj"
						 Targets="Build"
						 RebaseOutputs="false"
						 BuildInParallel="true" />

		<MSBuild Properties="Configuration=Release;InformationalVersion=$(GITVERSION_InformationalVersion);CI_Build=true;_IsCIBuild=true;TargetFramework=%(MixinTargetFrameworks.Identity)"
						 Projects="..\src\Uno.UI\Uno.UI.csproj"
						 Targets="GenerateMixins"
						 RebaseOutputs="false"
						 BuildInParallel="true" />
	</Target>

	<Target Name="GenerateDoc" DependsOnTargets="BuildSyncGenerator">
		
		<MSBuild Properties="Configuration=Debug"
				 Projects="..\src\Uno.Foundation.Logging\Uno.Foundation.Logging.csproj"
				 Targets="Restore;Build"
				 RebaseOutputs="false"
				 BuildInParallel="true" />

		<Exec Command="..\src\Uno.UWPSyncGenerator\Bin\Release\Uno.UWPSyncGenerator.exe &quot;doc&quot;" />
		<Exec Command="powershell .\import_external_docs.ps1" WorkingDirectory="..\doc" />
		<Exec Command="$(Pkgdocfx_console)\tools\docfx.exe ..\doc\docfx.json -o $(OutputDir)\doc" />
	</Target>

	<Target Name="RunAPISyncTool" DependsOnTargets="BuildSyncGenerator">
	
		<Exec Command="..\src\Uno.UWPSyncGenerator\Bin\Release\Uno.UWPSyncGenerator.exe &quot;sync&quot;" />
	</Target>

	<Target Name="PublishVSIX2019" Condition="'$(UNO_UWP_BUILD)'=='true'">
		<Copy SourceFiles="..\src\SolutionTemplate\UnoSolutionTemplate.VSIX.2019\bin\Release\UnoSolutionTemplate.VSIX.vsix"
					DestinationFiles="$(OutputDir)\vslatest-generic\UnoPlatform-$(GITVERSION_SemVer).x86.vsix" />
	</Target>
	
	<Target Name="PublishVSIX2022">
		<Copy SourceFiles="..\src\SolutionTemplate\UnoSolutionTemplate.VSIX.2022\bin\Release\UnoSolutionTemplate.VSIX.2022.vsix"
					DestinationFiles="$(OutputDir)\vslatest\UnoPlatform-$(GITVERSION_SemVer).x64.vsix" />
	</Target>

	<Target Name="PrepareNuGetPackage">

		<PropertyGroup>
			<NugetNamespace>
				<Namespace Prefix="x" Uri="http://schemas.microsoft.com/packaging/2010/07/nuspec.xsd" />
			</NugetNamespace>
			<PackageNamePrefix>Uno.WinUI</PackageNamePrefix>
			<PackageNamePrefix Condition="'$(UNO_UWP_BUILD)'=='true'">Uno.UI</PackageNamePrefix>
		</PropertyGroup>

		<ItemGroup>
			<_NuspecFiles Include=".\Uno.WinUI.nuspec" />
			<_NuspecFiles Include=".\Uno.WinUI.Lottie.nuspec" />
			<_NuspecFiles Include=".\Uno.WinUI.MSAL.nuspec" />
			<_NuspecFiles Include=".\Uno.WinUI.RemoteControl.nuspec" />
			<_NuspecFiles Include=".\Uno.WinUI.Skia.Gtk.nuspec" />
			<_NuspecFiles Include=".\Uno.WinUI.Skia.Linux.FrameBuffer.nuspec" />
			<_NuspecFiles Include=".\Uno.WinUI.Skia.Wpf.nuspec" />
			<_NuspecFiles Include=".\Uno.WinUI.Skia.Tizen.nuspec" />
			<_NuspecFiles Include=".\Uno.WinUI.WebAssembly.nuspec" />
			<_NuspecFiles Include=".\Uno.WinUI.XamlHost.nuspec" />
			<_NuspecFiles Include=".\Uno.WinUI.XamlHost.Skia.Wpf.nuspec" />
			<_NuspecFiles Include=".\Uno.Foundation.Logging.nuspec" />
			<_NuspecFiles Include=".\Uno.UI.Adapter.Microsoft.Extensions.Logging.nuspec" />
		</ItemGroup>

		<!-- Update Uno.WinUI references version -->
		<XmlPoke XmlInputPath="%(_NuspecFiles.Identity)" Query="/x:package/x:metadata/x:dependencies//x:dependency[@id='Uno.WinUI']/@version" Value="$(GITVERSION_SemVer)" Namespaces="$(NugetNamespace)" />
		
		<!-- Update Uno.Foundation.Runtime.WebAssembly references version -->
		<XmlPoke XmlInputPath="%(_NuspecFiles.Identity)" Query="/x:package/x:metadata/x:dependencies//x:dependency[@id='Uno.Foundation.Runtime.WebAssembly']/@version" Value="$(GITVERSION_SemVer)" Namespaces="$(NugetNamespace)" />

		<!-- Update Uno.WinUI.Runtime.WebAssembly references version -->
		<XmlPoke XmlInputPath="%(_NuspecFiles.Identity)" Query="/x:package/x:metadata/x:dependencies//x:dependency[@id='Uno.WinUI.Runtime.WebAssembly']/@version" Value="$(GITVERSION_SemVer)" Namespaces="$(NugetNamespace)" />

		<!-- Update Uno.WinUI.Runtime.Skia.Gtk references version -->
		<XmlPoke XmlInputPath="%(_NuspecFiles.Identity)" Query="/x:package/x:metadata/x:dependencies//x:dependency[@id='Uno.WinUI.Runtime.Skia.Gtk']/@version" Value="$(GITVERSION_SemVer)" Namespaces="$(NugetNamespace)" />

		<!-- Update Uno.WinUI.Runtime.Skia.Linux.FrameBuffer references version -->
		<XmlPoke XmlInputPath="%(_NuspecFiles.Identity)" Query="/x:package/x:metadata/x:dependencies//x:dependency[@id='Uno.WinUI.Runtime.Skia.Linux.FrameBuffer']/@version" Value="$(GITVERSION_SemVer)" Namespaces="$(NugetNamespace)" />

		<!-- Update Uno.WinUI.Runtime.Skia.Wpf references version -->
		<XmlPoke XmlInputPath="%(_NuspecFiles.Identity)" Query="/x:package/x:metadata/x:dependencies//x:dependency[@id='Uno.WinUI.Runtime.Skia.Wpf']/@version" Value="$(GITVERSION_SemVer)" Namespaces="$(NugetNamespace)" />

		<!-- Update Uno.WinUI.XamlHost references version -->
		<XmlPoke XmlInputPath="%(_NuspecFiles.Identity)" Query="/x:package/x:metadata/x:dependencies//x:dependency[@id='Uno.WinUI.XamlHost']/@version" Value="$(GITVERSION_SemVer)" Namespaces="$(NugetNamespace)" />

		<!-- Update Uno.WinUI.XamlHost.Skia.Wpf references version -->
		<XmlPoke XmlInputPath="%(_NuspecFiles.Identity)" Query="/x:package/x:metadata/x:dependencies//x:dependency[@id='Uno.WinUI.XamlHost.Skia.Wpf']/@version" Value="$(GITVERSION_SemVer)" Namespaces="$(NugetNamespace)" />

		<!-- Update Uno.WinUI.Runtime.Skia.Tizen references version -->
		<XmlPoke XmlInputPath="%(_NuspecFiles.Identity)" Query="/x:package/x:metadata/x:dependencies//x:dependency[@id='Uno.WinUI.Runtime.Skia.Tizen']/@version" Value="$(GITVERSION_SemVer)" Namespaces="$(NugetNamespace)" />

		<!-- Update Uno.WinUI.Runtime.Skia.Tizen references version -->
		<XmlPoke XmlInputPath="%(_NuspecFiles.Identity)" Query="/x:package/x:metadata/x:dependencies//x:dependency[@id='Uno.Foundation.Logging']/@version" Value="$(GITVERSION_SemVer)" Namespaces="$(NugetNamespace)" />

		<!-- Update Uno.UI.Adapter.Microsoft.Extensions.Logging references version -->
		<XmlPoke XmlInputPath="%(_NuspecFiles.Identity)" Query="/x:package/x:metadata/x:dependencies//x:dependency[@id='Uno.UI.Adapter.Microsoft.Extensions.Logging']/@version" Value="$(GITVERSION_SemVer)" Namespaces="$(NugetNamespace)" />

		<!-- Update package ID based on WinUI / UWP source tree -->
		<XmlPoke XmlInputPath=".\Uno.WinUI.nuspec" Query="/x:package/x:metadata/x:id" Value="$(PackageNamePrefix)" Namespaces="$(NugetNamespace)" />
		<XmlPoke XmlInputPath=".\Uno.WinUI.Lottie.nuspec" Query="/x:package/x:metadata/x:id" Value="$(PackageNamePrefix).Lottie" Namespaces="$(NugetNamespace)" />
		<XmlPoke XmlInputPath=".\Uno.WinUI.MSAL.nuspec" Query="/x:package/x:metadata/x:id" Value="$(PackageNamePrefix).MSAL" Namespaces="$(NugetNamespace)" />
		<XmlPoke XmlInputPath=".\Uno.WinUI.XamlHost.nuspec" Query="/x:package/x:metadata/x:id" Value="$(PackageNamePrefix).XamlHost" Namespaces="$(NugetNamespace)" />
		<XmlPoke XmlInputPath=".\Uno.WinUI.XamlHost.Skia.Wpf.nuspec" Query="/x:package/x:metadata/x:id" Value="$(PackageNamePrefix).XamlHost.Skia.Wpf" Namespaces="$(NugetNamespace)" />
		<XmlPoke XmlInputPath=".\Uno.WinUI.RemoteControl.nuspec" Query="/x:package/x:metadata/x:id" Value="$(PackageNamePrefix).RemoteControl" Namespaces="$(NugetNamespace)" />
		<XmlPoke XmlInputPath=".\Uno.WinUI.Skia.Gtk.nuspec" Query="/x:package/x:metadata/x:id" Value="$(PackageNamePrefix).Skia.Gtk" Namespaces="$(NugetNamespace)" />
		<XmlPoke XmlInputPath=".\Uno.WinUI.Skia.Linux.FrameBuffer.nuspec" Query="/x:package/x:metadata/x:id" Value="$(PackageNamePrefix).Skia.Linux.FrameBuffer" Namespaces="$(NugetNamespace)" />
		<XmlPoke XmlInputPath=".\Uno.WinUI.Skia.Wpf.nuspec" Query="/x:package/x:metadata/x:id" Value="$(PackageNamePrefix).Skia.Wpf" Namespaces="$(NugetNamespace)" />
		<XmlPoke XmlInputPath=".\Uno.WinUI.Skia.Tizen.nuspec" Query="/x:package/x:metadata/x:id" Value="$(PackageNamePrefix).Skia.Tizen" Namespaces="$(NugetNamespace)" />
		<XmlPoke XmlInputPath=".\Uno.WinUI.WebAssembly.nuspec" Query="/x:package/x:metadata/x:id" Value="$(PackageNamePrefix).WebAssembly" Namespaces="$(NugetNamespace)" />

		<!-- Update package Title based on WinUI / UWP source tree -->
		<XmlPoke XmlInputPath=".\Uno.WinUI.nuspec" Query="/x:package/x:metadata/x:title" Value="$(PackageNamePrefix)" Namespaces="$(NugetNamespace)" />
		<XmlPoke XmlInputPath=".\Uno.WinUI.Lottie.nuspec" Query="/x:package/x:metadata/x:title" Value="$(PackageNamePrefix).Lottie" Namespaces="$(NugetNamespace)" />
		<XmlPoke XmlInputPath=".\Uno.WinUI.MSAL.nuspec" Query="/x:package/x:metadata/x:title" Value="$(PackageNamePrefix).MSAL" Namespaces="$(NugetNamespace)" />
		<XmlPoke XmlInputPath=".\Uno.WinUI.XamlHost.nuspec" Query="/x:package/x:metadata/x:title" Value="$(PackageNamePrefix).XamlHost" Namespaces="$(NugetNamespace)" />
		<XmlPoke XmlInputPath=".\Uno.WinUI.XamlHost.Skia.Wpf.nuspec" Query="/x:package/x:metadata/x:title" Value="$(PackageNamePrefix).XamlHost.Skia.Wpf" Namespaces="$(NugetNamespace)" />
		<XmlPoke XmlInputPath=".\Uno.WinUI.RemoteControl.nuspec" Query="/x:package/x:metadata/x:title" Value="$(PackageNamePrefix).RemoteControl" Namespaces="$(NugetNamespace)" />
		<XmlPoke XmlInputPath=".\Uno.WinUI.Skia.Gtk.nuspec" Query="/x:package/x:metadata/x:title" Value="$(PackageNamePrefix).Skia.Gtk" Namespaces="$(NugetNamespace)" />
		<XmlPoke XmlInputPath=".\Uno.WinUI.Skia.Linux.FrameBuffer.nuspec" Query="/x:package/x:metadata/x:title" Value="$(PackageNamePrefix).Skia.Linux.FrameBuffer" Namespaces="$(NugetNamespace)" />
		<XmlPoke XmlInputPath=".\Uno.WinUI.Skia.Wpf.nuspec" Query="/x:package/x:metadata/x:title" Value="$(PackageNamePrefix).Skia.Wpf" Namespaces="$(NugetNamespace)" />
		<XmlPoke XmlInputPath=".\Uno.WinUI.Skia.Tizen.nuspec" Query="/x:package/x:metadata/x:title" Value="$(PackageNamePrefix).Skia.Tizen" Namespaces="$(NugetNamespace)" />
		<XmlPoke XmlInputPath=".\Uno.WinUI.WebAssembly.nuspec" Query="/x:package/x:metadata/x:title" Value="$(PackageNamePrefix).WebAssembly" Namespaces="$(NugetNamespace)" />

		<!-- Rename dependencies -->
		<XmlPoke XmlInputPath="%(_NuspecFiles.Identity)" Query="/x:package/x:metadata/x:dependencies//x:dependency[@id='Uno.WinUI']/@id" Value="$(PackageNamePrefix)" Namespaces="$(NugetNamespace)" />
		<XmlPoke XmlInputPath="%(_NuspecFiles.Identity)" Query="/x:package/x:metadata/x:dependencies//x:dependency[@id='Uno.WinUI.Runtime.Skia.Gtk']/@id" Value="$(PackageNamePrefix).Runtime.Skia.Gtk" Namespaces="$(NugetNamespace)" />
		<XmlPoke XmlInputPath="%(_NuspecFiles.Identity)" Query="/x:package/x:metadata/x:dependencies//x:dependency[@id='Uno.WinUI.Runtime.Skia.Linux.FrameBuffer']/@id" Value="$(PackageNamePrefix).Runtime.Skia.Linux.FrameBuffer" Namespaces="$(NugetNamespace)" />
		<XmlPoke XmlInputPath="%(_NuspecFiles.Identity)" Query="/x:package/x:metadata/x:dependencies//x:dependency[@id='Uno.WinUI.Runtime.Skia.Wpf']/@id" Value="$(PackageNamePrefix).Runtime.Skia.Wpf" Namespaces="$(NugetNamespace)" />
		<XmlPoke XmlInputPath="%(_NuspecFiles.Identity)" Query="/x:package/x:metadata/x:dependencies//x:dependency[@id='Uno.WinUI.Runtime.Skia.Tizen']/@id" Value="$(PackageNamePrefix).Runtime.Skia.Tizen" Namespaces="$(NugetNamespace)" />
		<XmlPoke XmlInputPath="%(_NuspecFiles.Identity)" Query="/x:package/x:metadata/x:dependencies//x:dependency[@id='Uno.WinUI.Runtime.WebAssembly']/@id" Value="$(PackageNamePrefix).Runtime.WebAssembly" Namespaces="$(NugetNamespace)" />
		<XmlPoke XmlInputPath="%(_NuspecFiles.Identity)" Query="/x:package/x:metadata/x:dependencies//x:dependency[@id='Uno.WinUI.XamlHost']/@id" Value="$(PackageNamePrefix).XamlHost" Namespaces="$(NugetNamespace)" />
		<XmlPoke XmlInputPath="%(_NuspecFiles.Identity)" Query="/x:package/x:metadata/x:dependencies//x:dependency[@id='Uno.WinUI.XamlHost.Skia.Wpf']/@id" Value="$(PackageNamePrefix).XamlHost.Skia.Wpf" Namespaces="$(NugetNamespace)" />

		<!-- Rename skiasharp references for WinUI -->
		<XmlPoke XmlInputPath=".\Uno.WinUI.Lottie.nuspec" Query="/x:package/x:metadata/x:dependencies//x:dependency[@id='SkiaSharp.Views.Uno']/@id" Value="SkiaSharp.Views.Uno.WinUI" Namespaces="$(NugetNamespace)" Condition="'$(UNO_UWP_BUILD)'!='true'" />

		<!-- Adjust build targets file to match WinUI / UWP-->
		<Move SourceFiles=".\uno.winui.targets" DestinationFiles=".\$(PackageNamePrefix).targets" Condition="'$(UNO_UWP_BUILD)'=='true'"/>
		<XmlPoke XmlInputPath=".\Uno.WinUI.nuspec" Query="/x:package/x:files/x:file[@src='Uno.WinUI.targets']/@src" Value="$(PackageNamePrefix).targets" Namespaces="$(NugetNamespace)" Condition="'$(UNO_UWP_BUILD)'=='true'"/>

		<!-- Adjust build targets file for Windows targets -->
		<XmlPoke XmlInputPath=".\Uno.WinUI.nuspec" Query="/x:package/x:files/x:file[@target='buildTransitive\uap10.0.16299\uno.winui.targets']/@target" Value="buildTransitive\uap10.0.16299\$(PackageNamePrefix).targets" Namespaces="$(NugetNamespace)" Condition="'$(UNO_UWP_BUILD)'=='true'"/>
		<XmlPoke XmlInputPath=".\Uno.WinUI.nuspec" Query="/x:package/x:files/x:file[@target='buildTransitive\uap10.0.18362\uno.winui.targets']/@target" Value="buildTransitive\uap10.0.18362\$(PackageNamePrefix).targets" Namespaces="$(NugetNamespace)" Condition="'$(UNO_UWP_BUILD)'=='true'"/>
		<XmlPoke XmlInputPath=".\Uno.WinUI.nuspec" Query="/x:package/x:files/x:file[@target='buildTransitive\net5.0-windows\uno.winui.targets']/@target" Value="buildTransitive\net5.0-windows\$(PackageNamePrefix).targets" Namespaces="$(NugetNamespace)" Condition="'$(UNO_UWP_BUILD)'=='true'"/>

		<!-- Skia GTK targets/props-->
		<Move SourceFiles=".\uno.winui.Skia.Gtk.targets" DestinationFiles=".\$(PackageNamePrefix).Skia.Gtk.targets" Condition="'$(UNO_UWP_BUILD)'=='true'"/>
		<Move SourceFiles=".\uno.winui.Skia.Gtk.props" DestinationFiles=".\$(PackageNamePrefix).Skia.Gtk.props" Condition="'$(UNO_UWP_BUILD)'=='true'"/>

		<XmlPoke XmlInputPath=".\uno.winui.Skia.Gtk.nuspec" Query="/x:package/x:files/x:file[@src='Uno.WinUI.Skia.Gtk.targets']/@src" Value="$(PackageNamePrefix).Skia.Gtk.targets" Namespaces="$(NugetNamespace)" Condition="'$(UNO_UWP_BUILD)'=='true'"/>
		<XmlPoke XmlInputPath=".\uno.winui.Skia.Gtk.nuspec" Query="/x:package/x:files/x:file[@src='Uno.WinUI.Skia.Gtk.props']/@src" Value="$(PackageNamePrefix).Skia.Gtk.props" Namespaces="$(NugetNamespace)" Condition="'$(UNO_UWP_BUILD)'=='true'"/>

		<!-- Skia Linux FrameBuffer targets/props-->
		<Move SourceFiles=".\uno.winui.Skia.Linux.FrameBuffer.targets" DestinationFiles=".\$(PackageNamePrefix).Skia.Linux.FrameBuffer.targets" Condition="'$(UNO_UWP_BUILD)'=='true'"/>
		<Move SourceFiles=".\uno.winui.Skia.Linux.FrameBuffer.props" DestinationFiles=".\$(PackageNamePrefix).Skia.Linux.FrameBuffer.props" Condition="'$(UNO_UWP_BUILD)'=='true'"/>

		<XmlPoke XmlInputPath=".\uno.winui.Skia.Linux.FrameBuffer.nuspec" Query="/x:package/x:files/x:file[@src='Uno.WinUI.Skia.Linux.FrameBuffer.targets']/@src" Value="$(PackageNamePrefix).Skia.Linux.FrameBuffer.targets" Namespaces="$(NugetNamespace)" Condition="'$(UNO_UWP_BUILD)'=='true'"/>
		<XmlPoke XmlInputPath=".\uno.winui.Skia.Linux.FrameBuffer.nuspec" Query="/x:package/x:files/x:file[@src='Uno.WinUI.Skia.Linux.FrameBuffer.props']/@src" Value="$(PackageNamePrefix).Skia.Linux.FrameBuffer.props" Namespaces="$(NugetNamespace)" Condition="'$(UNO_UWP_BUILD)'=='true'"/>

		<!-- Skia Tizen targets/props-->
		<Move SourceFiles=".\uno.winui.Skia.Tizen.targets" DestinationFiles=".\$(PackageNamePrefix).Skia.Tizen.targets" Condition="'$(UNO_UWP_BUILD)'=='true'"/>
		<Move SourceFiles=".\uno.winui.Skia.Tizen.props" DestinationFiles=".\$(PackageNamePrefix).Skia.Tizen.props" Condition="'$(UNO_UWP_BUILD)'=='true'"/>

		<XmlPoke XmlInputPath=".\uno.winui.Skia.Tizen.nuspec" Query="/x:package/x:files/x:file[@src='Uno.WinUI.Skia.Tizen.targets']/@src" Value="$(PackageNamePrefix).Skia.Tizen.targets" Namespaces="$(NugetNamespace)" Condition="'$(UNO_UWP_BUILD)'=='true'"/>
		<XmlPoke XmlInputPath=".\uno.winui.Skia.Tizen.nuspec" Query="/x:package/x:files/x:file[@src='Uno.WinUI.Skia.Tizen.props']/@src" Value="$(PackageNamePrefix).Skia.Tizen.props" Namespaces="$(NugetNamespace)" Condition="'$(UNO_UWP_BUILD)'=='true'"/>

		<!-- Skia Wpf targets/props-->
		<Move SourceFiles=".\uno.winui.Skia.Wpf.targets" DestinationFiles=".\$(PackageNamePrefix).Skia.Wpf.targets" Condition="'$(UNO_UWP_BUILD)'=='true'"/>
		<Move SourceFiles=".\uno.winui.Skia.Wpf.props" DestinationFiles=".\$(PackageNamePrefix).Skia.Wpf.props" Condition="'$(UNO_UWP_BUILD)'=='true'"/>

		<XmlPoke XmlInputPath=".\uno.winui.Skia.Wpf.nuspec" Query="/x:package/x:files/x:file[@src='Uno.WinUI.Skia.Wpf.targets']/@src" Value="$(PackageNamePrefix).Skia.Wpf.targets" Namespaces="$(NugetNamespace)" Condition="'$(UNO_UWP_BUILD)'=='true'"/>
		<XmlPoke XmlInputPath=".\uno.winui.Skia.Wpf.nuspec" Query="/x:package/x:files/x:file[@src='Uno.WinUI.Skia.Wpf.props']/@src" Value="$(PackageNamePrefix).Skia.Wpf.props" Namespaces="$(NugetNamespace)" Condition="'$(UNO_UWP_BUILD)'=='true'"/>

		<!-- Wasm targets/props-->
		<Move SourceFiles=".\uno.winui.WebAssembly.targets" DestinationFiles=".\$(PackageNamePrefix).WebAssembly.targets" Condition="'$(UNO_UWP_BUILD)'=='true'"/>
		<Move SourceFiles=".\uno.winui.WebAssembly.props" DestinationFiles=".\$(PackageNamePrefix).WebAssembly.props" Condition="'$(UNO_UWP_BUILD)'=='true'"/>

		<XmlPoke XmlInputPath=".\uno.winui.WebAssembly.nuspec" Query="/x:package/x:files/x:file[@src='Uno.WinUI.WebAssembly.targets']/@src" Value="$(PackageNamePrefix).WebAssembly.targets" Namespaces="$(NugetNamespace)" Condition="'$(UNO_UWP_BUILD)'=='true'"/>
		<XmlPoke XmlInputPath=".\uno.winui.WebAssembly.nuspec" Query="/x:package/x:files/x:file[@src='Uno.WinUI.WebAssembly.props']/@src" Value="$(PackageNamePrefix).WebAssembly.props" Namespaces="$(NugetNamespace)" Condition="'$(UNO_UWP_BUILD)'=='true'"/>

		<!-- remote control -->
		<Move SourceFiles="..\src\Uno.UI.RemoteControl\buildTransitive\Uno.UI.RemoteControl.targets" DestinationFiles="..\src\Uno.UI.RemoteControl\buildTransitive\$(PackageNamePrefix).RemoteControl.targets" Condition="'$(UNO_UWP_BUILD)'!='true'"/>

		<!-- Lottie move file -->
		<Move SourceFiles="..\src\AddIns\Uno.UI.Lottie\buildTransitive\Uno.UI.Lottie.targets" DestinationFiles="..\src\AddIns\Uno.UI.Lottie\buildTransitive\$(PackageNamePrefix).Lottie.targets" />
		
		<!-- MSAL move file -->
		<Move SourceFiles="..\src\AddIns\Uno.UI.MSAL\buildTransitive\Uno.UI.MSAL.targets" DestinationFiles="..\src\AddIns\Uno.UI.MSAL\buildTransitive\$(PackageNamePrefix).MSAL.targets" />
		
		<!-- XamlHost move file -->
		<Move SourceFiles="..\src\Uno.UI.XamlHost\buildTransitive\Uno.UI.XamlHost.props" DestinationFiles="..\src\Uno.UI.XamlHost\buildTransitive\$(PackageNamePrefix).XamlHost.props" />
		
		<XmlPoke XmlInputPath=".\Uno.WinUI.XamlHost.nuspec" Query="/x:package/x:files/x:file[@src='..\src\Uno.UI.XamlHost\buildTransitive\Uno.WinUI.XamlHost.props']/@src" Value="..\src\Uno.UI.XamlHost\buildTransitive\$(PackageNamePrefix).XamlHost.props" Namespaces="$(NugetNamespace)" Condition="'$(UNO_UWP_BUILD)'=='true'"/>

		<!-- Runtime package move files -->
		<Move SourceFiles="..\src\Uno.UI.Runtime.Skia.Gtk\buildTransitive\Uno.UI.Runtime.Skia.Gtk.props" DestinationFiles="..\src\Uno.UI.Runtime.Skia.Gtk\buildTransitive\$(PackageNamePrefix).Runtime.Skia.Gtk.props" />
		<Move SourceFiles="..\src\Uno.UI.Runtime.Skia.Gtk\buildTransitive\Uno.UI.Runtime.Skia.Gtk.targets" DestinationFiles="..\src\Uno.UI.Runtime.Skia.Gtk\buildTransitive\$(PackageNamePrefix).Runtime.Skia.Gtk.targets" />
		<Move SourceFiles="..\src\Uno.UI.Runtime.Skia.Linux.FrameBuffer\buildTransitive\Uno.UI.Runtime.Skia.Linux.FrameBuffer.props" DestinationFiles="..\src\Uno.UI.Runtime.Skia.Linux.FrameBuffer\buildTransitive\$(PackageNamePrefix).Runtime.Skia.Linux.FrameBuffer.props" />
		<Move SourceFiles="..\src\Uno.UI.Runtime.Skia.Linux.FrameBuffer\buildTransitive\Uno.UI.Runtime.Skia.Linux.FrameBuffer.targets" DestinationFiles="..\src\Uno.UI.Runtime.Skia.Linux.FrameBuffer\buildTransitive\$(PackageNamePrefix).Runtime.Skia.Linux.FrameBuffer.targets" />
		<Move SourceFiles="..\src\Uno.UI.Runtime.Skia.Tizen\buildTransitive\Uno.UI.Runtime.Skia.Tizen.props" DestinationFiles="..\src\Uno.UI.Runtime.Skia.Tizen\buildTransitive\$(PackageNamePrefix).Runtime.Skia.Tizen.props" />
		<Move SourceFiles="..\src\Uno.UI.Runtime.Skia.Tizen\buildTransitive\Uno.UI.Runtime.Skia.Tizen.targets" DestinationFiles="..\src\Uno.UI.Runtime.Skia.Tizen\buildTransitive\$(PackageNamePrefix).Runtime.Skia.Tizen.targets" />
		<Move SourceFiles="..\src\Uno.UI.Runtime.Skia.Wpf\buildTransitive\Uno.UI.Runtime.Skia.Wpf.props" DestinationFiles="..\src\Uno.UI.Runtime.Skia.Wpf\buildTransitive\$(PackageNamePrefix).Runtime.Skia.Wpf.props" />
		<Move SourceFiles="..\src\Uno.UI.Runtime.Skia.Wpf\buildTransitive\Uno.UI.Runtime.Skia.Wpf.targets" DestinationFiles="..\src\Uno.UI.Runtime.Skia.Wpf\buildTransitive\$(PackageNamePrefix).Runtime.Skia.Wpf.targets" />
		<Move SourceFiles="..\src\Uno.UI.Runtime.WebAssembly\buildTransitive\Uno.UI.Runtime.WebAssembly.props" DestinationFiles="..\src\Uno.UI.Runtime.WebAssembly\buildTransitive\$(PackageNamePrefix).Runtime.WebAssembly.props" />
		<Move SourceFiles="..\src\Uno.UI.Runtime.WebAssembly\buildTransitive\Uno.UI.Runtime.WebAssembly.targets" DestinationFiles="..\src\Uno.UI.Runtime.WebAssembly\buildTransitive\$(PackageNamePrefix).Runtime.WebAssembly.targets" />
	</Target>

	<Target Name="BuildNuGetPackage">
		<PropertyGroup>
			<NuSpecProperties>NoWarn=NU5100,NU5105,NU5131;branch=$(GITVERSION_BranchName);commitid=$(GITVERSION_VersionSourceSha)</NuSpecProperties>

			<NuSpecProperties Condition="'$(UNO_UWP_BUILD)'=='true'">$(NuSpecProperties);winuisourcepath=uap10.0.18362;winuitargetpath=UAP</NuSpecProperties>
			<NuSpecProperties Condition="'$(UNO_UWP_BUILD)'!='true'">$(NuSpecProperties);winuisourcepath=net5.0-windows10.0.18362.0;winuitargetpath=net5.0-windows10.0.18362.0</NuSpecProperties>
		</PropertyGroup>

		<!-- Pre-validation of contents to be packed -->
		<Error Text="The Uno.UI.Toolkit PRI file is not present in src\Uno.UI.Toolkit\bin\Release"
					 Condition="'$(UNO_UWP_BUILD)'=='true' and !exists('..\src\Uno.UI.Toolkit\bin\Release\uap10.0.18362\Uno.UI.Toolkit.pri')" />
		<Error Text="The Uno.UI.Toolkit PRI file is not present in src\Uno.UI.Toolkit\bin\Release"
					 Condition="'$(UNO_UWP_BUILD)'!='true' and !exists('..\src\Uno.UI.Toolkit\bin\Release\net5.0-windows10.0.18362.0\Uno.UI.Toolkit.pri')" />

		<!-- Create the packages -->
		<Exec Command="$(NuGetBin) pack Uno.WinUI.nuspec -Verbosity Detailed -Version &quot;$(GITVERSION_SemVer)&quot; -Properties &quot;$(NuSpecProperties)&quot;" />
		<Exec Command="$(NuGetBin) pack Uno.WinUI.Lottie.nuspec -Verbosity Detailed -Version &quot;$(GITVERSION_SemVer)&quot; -Properties &quot;$(NuSpecProperties)&quot;" />
		<Exec Command="$(NuGetBin) pack Uno.WinUI.MSAL.nuspec -Verbosity Detailed -Version &quot;$(GITVERSION_SemVer)&quot; -Properties &quot;$(NuSpecProperties)&quot;" />
		<Exec Command="$(NuGetBin) pack Uno.WinUI.RemoteControl.nuspec -Verbosity Detailed -Version &quot;$(GITVERSION_SemVer)&quot; -Properties &quot;$(NuSpecProperties)&quot;" />
		<Exec Command="$(NuGetBin) pack Uno.WinUI.Skia.Gtk.nuspec -Verbosity Detailed -Version &quot;$(GITVERSION_SemVer)&quot; -Properties &quot;$(NuSpecProperties)&quot;" />
		<Exec Command="$(NuGetBin) pack Uno.WinUI.Skia.Linux.FrameBuffer.nuspec -Verbosity Detailed -Version &quot;$(GITVERSION_SemVer)&quot; -Properties &quot;$(NuSpecProperties)&quot;" />
		<Exec Command="$(NuGetBin) pack Uno.WinUI.Skia.Tizen.nuspec -Verbosity Detailed -Version &quot;$(GITVERSION_SemVer)&quot; -Properties &quot;$(NuSpecProperties)&quot;" />
		<Exec Command="$(NuGetBin) pack Uno.WinUI.Skia.Wpf.nuspec -Verbosity Detailed -Version &quot;$(GITVERSION_SemVer)&quot; -Properties &quot;$(NuSpecProperties)&quot;" />
		<Exec Command="$(NuGetBin) pack Uno.WinUI.XamlHost.nuspec -Verbosity Detailed -Version &quot;$(GITVERSION_SemVer)&quot; -Properties &quot;$(NuSpecProperties)&quot;" />
		<Exec Command="$(NuGetBin) pack Uno.WinUI.XamlHost.Skia.Wpf.nuspec -Verbosity Detailed -Version &quot;$(GITVERSION_SemVer)&quot; -Properties &quot;$(NuSpecProperties)&quot;" />
		<Exec Command="$(NuGetBin) pack Uno.WinUI.WebAssembly.nuspec -Verbosity Detailed -Version &quot;$(GITVERSION_SemVer)&quot; -Properties &quot;$(NuSpecProperties)&quot;" />
		<Exec Command="$(NuGetBin) pack Uno.Foundation.Logging.nuspec -Verbosity Detailed -Version &quot;$(GITVERSION_SemVer)&quot; -Properties &quot;$(NuSpecProperties)&quot;" />
		<Exec Command="$(NuGetBin) pack Uno.UI.Adapter.Microsoft.Extensions.Logging.nuspec -Verbosity Detailed -Version &quot;$(GITVERSION_SemVer)&quot; -Properties &quot;$(NuSpecProperties)&quot;" />
	</Target>

	<Target Name="ValidatePackage" AfterTargets="BuildNuGetPackage" Condition="'$(BuildingInsideVisualStudio)'=='' and '$(UNO_UWP_BUILD)'=='true'">
		<PropertyGroup>
			<PackageNamePrefix>Uno.WinUI</PackageNamePrefix>
			<PackageNamePrefix Condition="'$(UNO_UWP_BUILD)'=='true'">Uno.UI</PackageNamePrefix>
		</PropertyGroup>

		<Exec Command="dotnet tool install --tool-path $(MSBuildThisFileDirectory)\tools Uno.PackageDiff --version 1.1.0-dev.14" IgnoreExitCode="true" />
		<Exec Command="$(MSBuildThisFileDirectory)\tools\generatepkgdiff.exe --base=$(PackageNamePrefix) --other=$(PackageNamePrefix).$(GITVERSION_SemVer).nupkg --diffignore=PackageDiffIgnore.xml --outfile=$(OutputDir)\ApiDiff.$(GITVERSION_SemVer).md" />
	</Target>
	
	<Target Name="ValidatePackageReferenceAPI" AfterTargets="BuildNuGetPackage">
		<PropertyGroup>
			<PackageNamePrefix>Uno.WinUI</PackageNamePrefix>
			<PackageNamePrefix Condition="'$(UNO_UWP_BUILD)'=='true'">Uno.UI</PackageNamePrefix>
		</PropertyGroup>

		<Exec Command="dotnet $(MSBuildThisFileDirectory)..\src\Uno.ReferenceImplComparer\bin\Release\Uno.ReferenceImplComparer.dll $(MSBuildThisFileDirectory)$(PackageNamePrefix).$(GITVERSION_SemVer).nupkg" />
	</Target>

</Project>
